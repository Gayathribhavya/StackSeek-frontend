{"version":3,"file":"node-build.mjs","sources":["../../server/routes/repositories.ts","../../server/routes/analyze-error.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\nimport { ConnectRepositoryRequest, ConnectRepositoryResponse } from \"../../shared/api\";\n\nexport interface Repository {\n  id: string;\n  name: string;\n  owner: string;\n  branch: string;\n  language: string;\n  stars?: number;\n  updated: string;\n  url: string;\n  private: boolean;\n}\n\nexport interface RepositoriesResponse {\n  success: boolean;\n  repositories: Repository[];\n  error?: string;\n}\n\nexport const getRepositories: RequestHandler = async (req, res) => {\n  // Repository fetching is handled by the .NET backend\n  // Frontend should call wm3s5emyme.ap-south-1.awsapprunner.com/api/repository/user directly\n  res.status(501).json({\n    success: false,\n    repositories: [],\n    error: 'Repository fetching is handled by the .NET backend at wm3s5emyme.ap-south-1.awsapprunner.com/api/repository/user'\n  });\n};\n\nexport const connectRepository: RequestHandler = async (req, res) => {\n  // This endpoint is kept for backward compatibility but actual repository\n  // connections should be handled through the .NET backend at wm3s5emyme.ap-south-1.awsapprunner.com\n  res.status(501).json({\n    success: false,\n    repository: {} as any,\n    message: 'Repository connections are handled by the .NET backend at wm3s5emyme.ap-south-1.awsapprunner.com/api/repository/connect'\n  });\n};\n","import { RequestHandler } from \"express\";\n\nexport interface AnalysisRequest {\n  repositoryId: string;\n  errorMessage: string;\n  codeSnippet?: string;\n}\n\nexport interface AnalysisResult {\n  root_cause_analysis: string;\n  error_location: string;\n  execution_path: string;\n  replication_steps: string[];\n  suggested_fix: string;\n}\n\nexport interface AnalysisMetrics {\n  llm_input_tokens: number;\n  llm_output_tokens: number;\n  total_llm_tokens: number;\n  analysis_time_ms: number;\n}\n\nexport interface AnalysisResponse {\n  success: boolean;\n  data?: {\n    analysis: AnalysisResult;\n    metrics: AnalysisMetrics;\n  };\n  error?: string;\n}\n\nexport const analyzeError: RequestHandler = async (req, res) => {\n  try {\n    const { repositoryId, errorMessage, codeSnippet } = req.body as AnalysisRequest;\n\n    // Validate input\n    if (!repositoryId || !errorMessage) {\n      return res.status(400).json({\n        success: false,\n        error: 'Repository ID and error message are required'\n      });\n    }\n\n    // TODO: Implement actual error analysis logic\n    // This would typically involve:\n    // 1. Validating repository access\n    // 2. Preparing context from repository\n    // 3. Sending error + context to AI service\n    // 4. Processing and returning results\n    \n    // For now, return an error indicating the service is not implemented\n    res.status(501).json({\n      success: false,\n      error: 'Error analysis service is not yet implemented. Please connect your repository and configure the AI analysis backend.'\n    });\n\n  } catch (error) {\n    console.error('Error analyzing error:', error);\n    res.status(500).json({\n      success: false,\n      error: 'Internal server error during analysis'\n    });\n  }\n};\n","import \"dotenv/config\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport path from \"path\";\nimport { getRepositories, connectRepository } from \"./routes/repositories\";\nimport { analyzeError } from \"./routes/analyze-error\";\n\nexport function createServer() {\n  const app = express();\n\n  // Middleware\n  app.use(cors());\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n\n  // Health check endpoint\n  app.get(\"/api/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\n    res.json({ message: ping });\n  });\n\n  // API endpoints\n  app.get(\"/api/repositories\", getRepositories);\n  app.post(\"/api/repositories\", connectRepository);\n  app.post(\"/api/analyze-error\", analyzeError);\n\n  // Note: OAuth is handled by the .NET backend at wm3s5emyme.ap-south-1.awsapprunner.com\n\n  // SPA fallback - handle client-side routing\n  app.get(\"*\", (_req, res, next) => {\n    // Skip API routes - let them pass through\n    if (_req.path.startsWith(\"/api\")) {\n      return next();\n    }\n    \n    // In development with Vite, we need to let Vite's dev server handle static files\n    // but still provide fallback for SPA routes\n    if (process.env.NODE_ENV !== \"production\") {\n      // For development, we'll let this pass through to Vite\n      return next();\n    }\n    \n    // In production, serve the built index.html for all SPA routes\n    res.sendFile(path.join(__dirname, \"../dist/spa/index.html\"));\n  });\n\n  return app;\n}\n","import path from \"path\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __dirname = import.meta.dirname;\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.get(\"*\", (req, res) => {\n  // Don't serve index.html for API routes\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n\n  res.sendFile(path.join(distPath, \"index.html\"));\n});\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["app","express","__dirname"],"mappings":";;;;;AAqBa,MAAA,kBAAkC,OAAO,KAAK,QAAQ;AAG7D,MAAA,OAAO,GAAG,EAAE,KAAK;AAAA,IACnB,SAAS;AAAA,IACT,cAAc,CAAC;AAAA,IACf,OAAO;AAAA,EAAA,CACR;AACH;AAEa,MAAA,oBAAoC,OAAO,KAAK,QAAQ;AAG/D,MAAA,OAAO,GAAG,EAAE,KAAK;AAAA,IACnB,SAAS;AAAA,IACT,YAAY,CAAC;AAAA,IACb,SAAS;AAAA,EAAA,CACV;AACH;ACPa,MAAA,eAA+B,OAAO,KAAK,QAAQ;AAC1D,MAAA;AACF,UAAM,EAAE,cAAc,cAAc,gBAAgB,IAAI;AAGpD,QAAA,CAAC,gBAAgB,CAAC,cAAc;AAClC,aAAO,IAAI,OAAO,GAAG,EAAE,KAAK;AAAA,QAC1B,SAAS;AAAA,QACT,OAAO;AAAA,MAAA,CACR;AAAA,IAAA;AAWC,QAAA,OAAO,GAAG,EAAE,KAAK;AAAA,MACnB,SAAS;AAAA,MACT,OAAO;AAAA,IAAA,CACR;AAAA,WAEM,OAAO;AACN,YAAA,MAAM,0BAA0B,KAAK;AACzC,QAAA,OAAO,GAAG,EAAE,KAAK;AAAA,MACnB,SAAS;AAAA,MACT,OAAO;AAAA,IAAA,CACR;AAAA,EAAA;AAEL;ACzDO,SAAS,eAAe;AAC7B,QAAMA,OAAMC,iBAAQ;AAGhB,EAAAD,KAAA,IAAI,MAAM;AACV,EAAAA,KAAA,IAAIC,iBAAQ,MAAM;AACtB,EAAAD,KAAI,IAAIC,iBAAQ,WAAW,EAAE,UAAU,KAAA,CAAM,CAAC;AAG9C,EAAAD,KAAI,IAAI,aAAa,CAAC,MAAM,QAAQ;AAC5B,UAAA,OAAO,QAAQ,IAAI,gBAAgB;AACzC,QAAI,KAAK,EAAE,SAAS,KAAA,CAAM;AAAA,EAAA,CAC3B;AAGG,EAAAA,KAAA,IAAI,qBAAqB,eAAe;AACxC,EAAAA,KAAA,KAAK,qBAAqB,iBAAiB;AAC3C,EAAAA,KAAA,KAAK,sBAAsB,YAAY;AAK3C,EAAAA,KAAI,IAAI,KAAK,CAAC,MAAM,KAAK,SAAS;AAEhC,QAAI,KAAK,KAAK,WAAW,MAAM,GAAG;AAChC,aAAO,KAAK;AAAA,IAAA;AAWd,QAAI,SAAS,KAAK,KAAK,WAAW,wBAAwB,CAAC;AAAA,EAAA,CAC5D;AAEM,SAAAA;AACT;AC3CA,MAAM,MAAM,aAAa;AACzB,MAAM,OAAO,QAAQ,IAAI,QAAQ;AAGjC,MAAME,cAAY,YAAY;AAC9B,MAAM,WAAW,KAAK,KAAKA,aAAW,QAAQ;AAG9C,IAAI,IAAI,QAAQ,OAAO,QAAQ,CAAC;AAGhC,IAAI,IAAI,KAAK,CAAC,KAAK,QAAQ;AAErB,MAAA,IAAI,KAAK,WAAW,OAAO,KAAK,IAAI,KAAK,WAAW,SAAS,GAAG;AAC3D,WAAA,IAAI,OAAO,GAAG,EAAE,KAAK,EAAE,OAAO,0BAA0B;AAAA,EAAA;AAGjE,MAAI,SAAS,KAAK,KAAK,UAAU,YAAY,CAAC;AAChD,CAAC;AAED,IAAI,OAAO,MAAM,MAAM;AACb,UAAA,IAAI,4CAA4C,IAAI,EAAE;AACtD,UAAA,IAAI,iCAAiC,IAAI,EAAE;AAC3C,UAAA,IAAI,4BAA4B,IAAI,MAAM;AACpD,CAAC;AAGD,QAAQ,GAAG,WAAW,MAAM;AAC1B,UAAQ,IAAI,+CAA+C;AAC3D,UAAQ,KAAK,CAAC;AAChB,CAAC;AAED,QAAQ,GAAG,UAAU,MAAM;AACzB,UAAQ,IAAI,8CAA8C;AAC1D,UAAQ,KAAK,CAAC;AAChB,CAAC;"}